@using AGEERP.Models
@{
    ViewBag.Title = "Model Pair Policy";
}

<div class="card">
    <div class="content-header">
        <div class="card-header">
            <h3 class="card-title">Model Pair Policy</h3>
            <div class="card-tools">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/Home/Index">Home</a></li>
                    <li class="breadcrumb-item active">Model Pair Policy</li>
                </ol>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div id="frm" class="row">
            <div class="col-md-3"  style="margin-top:-6px">
                @Html.Label("Company")
                @(Html.Kendo()
                .DropDownList()
                .Name("ComId")
                .OptionLabel("Select Company")
                .DataValueField("ComId")
                .DataTextField("ComName")
                .DataSource(ds =>
                {
                ds.Read(read => read.Action("CompanyList", "Setup"));
                })
                .HtmlAttributes(new { @style = "width:100%", @required = true })
                )

            </div>
            <div class="col-md-3">
                @Html.Label("Product")
                @(Html.Kendo()
                .DropDownList()
                .Name("ProductId")
                .OptionLabel("Select Product")
                .DataValueField("ProductId")
                .DataTextField("Name")
                .CascadeFrom("ComId")
                .DataSource(ds =>
                {
                ds.Read(read => read.Action("ProductByCompList", "Setup").Data("filterProduct"))
                .ServerFiltering(true);
                })
                .HtmlAttributes(new { @style = "width:100%", @required = true })
                )
            </div>
            <div class="col-md-3">
                @Html.Label("Model")
                @(Html.Kendo()
                .DropDownList()
                .Name("ModelId")
                .OptionLabel("Select Model")
                .DataValueField("ModelId")
                .DataTextField("Model")
                .CascadeFrom("ProductId")
                .Events(e => e.Change("LoadGrid"))
                .DataSource(ds =>
                {
                ds.Read(read => read.Action("ModelByComProList", "Setup").Data("filterModel"))
                .ServerFiltering(true);
                })
                .HtmlAttributes(new { @style = "width:100%", @required = true })
                )
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 col-md-12 col-xs-12">
        @(Html.Kendo()
                          .Grid<ModelPairPolicyVM>()
                          .Name("gridModelPairPolicy")
                          .Columns(columns =>
                          {

                                      columns.Bound(c => c.PolicyId).Hidden();
                              columns.Bound(c => c.ModelId).Hidden();
                              columns.Bound(c => c.RatioPurQty);
                              columns.Bound(c => c.RatioGiftQty);
                              columns.ForeignKey(c => c.FOCModelId, (System.Collections.IEnumerable)ViewData["ModelVD"], "ModelId", "Model").Title("Model");
                              columns.Bound(c => c.ExtraCharges);
                              columns.Bound(c => c.FromDate).EditorTemplateName("Date").Format("{0: dd/MM/yyyy}");
                              columns.Bound(c => c.ToDate).EditorTemplateName("Date").Format("{0: dd/MM/yyyy}");
                              columns.Bound(c => c.Remarks);
                              columns.Command(c => { c.Edit(); c.Destroy(); }).Width(220);
                          })
                          .Pageable()
                          .Sortable()
                          .Scrollable()
                          .AutoBind(false)
                          .ToolBar(t => t.Create())
                          .Editable(e => e.Mode(GridEditMode.InLine))
                          .HtmlAttributes(new { style = "height:400px;" })
                          .Events(e => e.Save("onSaveChanges"))
                          .DataSource(dataSource => dataSource
                          .Ajax()
                          .PageSize(20)
                          .Events(e => e.Error("error_handler"))
                          .Model(model =>
                          {
                              model.Id(m => m.PolicyId);
                          })
                          .Read(read => read.Action("ModelPairPolicy_Read", "Setup").Data("ModelData"))
                          .Create(create => create.Action("ModelPairPolicy_Create", "Setup").Data("ModelData"))
                          .Update(update => update.Action("ModelPairPolicy_Update", "Setup"))
                          .Destroy(update => update.Action("ModelPairPolicy_Destroy", "Setup"))
                          ))
    </div>
    </div>

        @section scripts
{
            <script type="text/javascript">
                var gridElement = $("#gridModelPairPolicy");
                var validator = $("#frm").kendoValidator().data("kendoValidator");
                $(document).ready(function () {
                    resizeGrid();
                    //$('#m_10000000').addClass('active');
                    //$('#d_10000000').css("display", "block");
                    //$('#m_10010000').addClass('active');
                    //$('#d_10010000').css("display", "block");
                    //$('#m_10011100').addClass('active');
                    //$('#a_10011100').addClass('active');
                });
                function onSaveChanges(e) {
                    if (!validator.validate()) {
                        e.preventDefault();
                    }
                }
                function filterProduct() {
                    return {
                        ComId: $('#ComId').val()
                    }
                }
                function filterModel() {
                    return {
                        ComId: $('#ComId').val(),
                        ProductId: $('#ProductId').val()
                    }
                }
                function ModelData() {
                    return {
                        Model: $('#ModelId').val()
                    }
                }
                function LoadGrid() {
                    $('#gridModelPairPolicy').data('kendoGrid').dataSource.read();
                }

                function resizeGrid() {
                    var height = $(window).innerHeight() - $('header').innerHeight() - 180;
                    if (height < 200) {
                        height = 200;
                    }
                    else if (height > 910) {
                        height = 910;
                    }
                    $("#gridModelPairPolicy").css("height", height);
                    gridElement.data("kendoGrid").resize();
                }

                $(window).resize(function () {
                    resizeGrid();
                });
                function error_handler(e) {
                    if (e.errors) {
                        var message = "Errors:\n";
                        $.each(e.errors, function (key, value) {
                            if ('errors' in value) {
                                $.each(value.errors, function () {
                                    message += this + "\n";
                                });
                            }
                        });
                        var dia = $("#msgBox").data("kendoDialog");
                        dia.title("Error");
                        dia.content(message);
                        dia.open();
                    }
                }
            </script>

        }
